<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memory System Workflow</title>
    <style>
        body {
            font-family: 'Monaco', 'Menlo', monospace;
            background: #0a0a0a;
            color: #e0e0e0;
            margin: 0;
            padding: 20px;
            line-height: 1.4;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            color: #00ff88;
            margin-bottom: 30px;
            font-size: 24px;
        }
        
        .workflow {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }
        
        .flow-section {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 20px;
            position: relative;
        }
        
        .flow-title {
            color: #00ff88;
            font-weight: bold;
            margin-bottom: 15px;
            font-size: 16px;
        }
        
        .step {
            background: #2a2a2a;
            border: 1px solid #444;
            border-radius: 4px;
            padding: 12px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }
        
        .step:hover {
            background: #333;
            border-color: #00ff88;
            transform: translateX(5px);
        }
        
        .step.active {
            background: #003322;
            border-color: #00ff88;
        }
        
        .trigger {
            color: #ffaa00;
            font-weight: bold;
        }
        
        .action {
            color: #00aaff;
        }
        
        .data {
            color: #ff6666;
        }
        
        .example {
            background: #1a1a2a;
            border: 1px solid #444;
            border-radius: 4px;
            padding: 15px;
            margin-top: 20px;
            display: none;
        }
        
        .example.show {
            display: block;
        }
        
        .example-title {
            color: #00ff88;
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .code {
            background: #0a0a0a;
            border: 1px solid #333;
            border-radius: 4px;
            padding: 10px;
            font-family: 'Monaco', monospace;
            font-size: 12px;
            overflow-x: auto;
        }
        
        .data-structure {
            grid-column: 1 / -1;
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }
        
        .tag {
            background: #333;
            color: #00ff88;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .tag:hover {
            background: #00ff88;
            color: #000;
        }
        
        .demo-section {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .demo-input {
            background: #2a2a2a;
            border: 1px solid #444;
            border-radius: 4px;
            padding: 10px;
            color: #e0e0e0;
            width: 100%;
            margin-bottom: 15px;
            font-family: 'Monaco', monospace;
        }
        
        .demo-btn {
            background: #00ff88;
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            margin-right: 10px;
        }
        
        .demo-btn:hover {
            background: #00cc66;
        }
        
        .demo-output {
            background: #0a0a0a;
            border: 1px solid #333;
            border-radius: 4px;
            padding: 15px;
            margin-top: 15px;
            min-height: 60px;
        }
        
        .arrow {
            position: absolute;
            right: -15px;
            top: 50%;
            transform: translateY(-50%);
            color: #00ff88;
            font-size: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Memory System Visual Workflow</h1>
        
        <div class="data-structure">
            <div class="flow-title">üì¶ Data Structure</div>
            <div class="code">
{
  "text": "Prefers blunt, fast communication",
  "timestamp": "2025-06-23T12:40:00Z", 
  "tags": ["preference"],
  "embedding": [0.1, -0.3, 0.8, ...]
}</div>
            <div class="tags">
                <span class="tag">goal</span>
                <span class="tag">routine</span>
                <span class="tag">preference</span>
                <span class="tag">constraint</span>
                <span class="tag">habit</span>
                <span class="tag">project</span>
                <span class="tag">tool</span>
                <span class="tag">identity</span>
                <span class="tag">value</span>
            </div>
        </div>
        
        <div class="workflow">
            <div class="flow-section">
                <div class="flow-title">üìù Memory Write Flow</div>
                
                <div class="step" onclick="showExample('write-example')">
                    <span class="trigger">TRIGGER:</span> Input matches patterns<br>
                    "I prefer...", "I always...", "remember this"
                    <div class="arrow">‚Üí</div>
                </div>
                
                <div class="step" onclick="showExample('filter-example')">
                    <span class="action">FILTER:</span> Check persistence<br>
                    Skip ephemeral states, keep stable traits
                </div>
                
                <div class="step" onclick="showExample('tag-example')">
                    <span class="action">TAG:</span> Keyword matching<br>
                    "prefer" ‚Üí preference, "always" ‚Üí routine
                </div>
                
                <div class="step" onclick="showExample('conflict-example')">
                    <span class="action">CONFLICT:</span> Check similarity > 0.85<br>
                    Flag contradictions, sort by recency
                </div>
                
                <div class="step" onclick="showExample('store-example')">
                    <span class="data">STORE:</span> Save to SQLite + embedding<br>
                    Vector index for semantic search
                </div>
            </div>
            
            <div class="flow-section">
                <div class="flow-title">üîç Memory Retrieval Flow</div>
                
                <div class="step" onclick="showExample('retrieve-trigger')">
                    <span class="trigger">TRIGGER:</span> Query patterns<br>
                    "What do you know about...", "Remind me..."
                    <div class="arrow">‚Üí</div>
                </div>
                
                <div class="step" onclick="showExample('embed-example')">
                    <span class="action">EMBED:</span> Convert query to vector<br>
                    Using sentence-transformers
                </div>
                
                <div class="step" onclick="showExample('search-example')">
                    <span class="action">SEARCH:</span> Top-K similarity search<br>
                    Find most relevant memories
                </div>
                
                <div class="step" onclick="showExample('inject-example')">
                    <span class="action">INJECT:</span> Add to LLM context<br>
                    Prepend matched memories to prompt
                </div>
                
                <div class="step" onclick="showExample('respond-example')">
                    <span class="data">RESPOND:</span> LLM uses memories<br>
                    Personalized response with context
                </div>
            </div>
        </div>
        
        <!-- Examples that appear when clicking steps -->
        <div id="write-example" class="example">
            <div class="example-title">Write Trigger Example</div>
            <div class="code">
Input: "I prefer blunt, fast communication"
‚úÖ Matches pattern: "I prefer..."
‚úÖ Contains durational keyword: "prefer"
‚Üí Proceed to store
            </div>
        </div>
        
        <div id="filter-example" class="example">
            <div class="example-title">Persistence Filter Example</div>
            <div class="code">
‚úÖ "I always wake up at 6am" ‚Üí Store (routine)
‚ùå "I'm tired today" ‚Üí Skip (ephemeral)
‚úÖ "I hate interruptions" ‚Üí Store (preference)
‚ùå "I had coffee this morning" ‚Üí Skip (one-off)
            </div>
        </div>
        
        <div id="tag-example" class="example">
            <div class="example-title">Tag Assignment Example</div>
            <div class="code">
"I prefer direct feedback" ‚Üí "preference"
"I always check email at 9am" ‚Üí "routine"  
"I am a software engineer" ‚Üí "identity"
"I want to learn Python" ‚Üí "goal"
            </div>
        </div>
        
        <div id="conflict-example" class="example">
            <div class="example-title">Conflict Detection Example</div>
            <div class="code">
Existing: "I prefer email communication"
New: "I hate email, prefer Slack"
Similarity: 0.92 > 0.85 ‚úÖ
Contradiction detected ‚ö†Ô∏è
‚Üí Flag for user review, sort by recency
            </div>
        </div>
        
        <div id="store-example" class="example">
            <div class="example-title">Storage Process</div>
            <div class="code">
1. Generate embedding: sentence_transformer.encode(text)
2. Store in SQLite: INSERT INTO memories (text, timestamp, tags, embedding)
3. Update vector index for fast similarity search
4. Return success confirmation
            </div>
        </div>
        
        <div id="retrieve-trigger" class="example">
            <div class="example-title">Retrieval Trigger Example</div>
            <div class="code">
‚úÖ "What do you know about my communication style?"
‚úÖ "What are my preferences?" 
‚úÖ "Remind me what I said about meetings"
‚ùå "What's the weather today?" (no self-reference)
            </div>
        </div>
        
        <div id="embed-example" class="example">
            <div class="example-title">Query Embedding</div>
            <div class="code">
Query: "What are my communication preferences?"
‚Üí Embedding: [0.2, -0.1, 0.7, 0.3, ...]
‚Üí Used for similarity search against stored embeddings
            </div>
        </div>
        
        <div id="search-example" class="example">
            <div class="example-title">Similarity Search Results</div>
            <div class="code">
Top matches:
1. "Prefers blunt, fast communication" (similarity: 0.94)
2. "Hates small talk in meetings" (similarity: 0.87)
3. "Values direct feedback" (similarity: 0.82)
            </div>
        </div>
        
        <div id="inject-example" class="example">
            <div class="example-title">Context Injection</div>
            <div class="code">
LLM Prompt:
"[MEMORY CONTEXT]
- User prefers blunt, fast communication
- User hates small talk in meetings
- User values direct feedback
[/MEMORY CONTEXT]

User: What do you know about my communication style?
Assistant: ..."
            </div>
        </div>
        
        <div id="respond-example" class="example">
            <div class="example-title">Personalized Response</div>
            <div class="code">
"Based on what you've told me, you prefer blunt, fast communication 
and hate small talk in meetings. You value direct feedback and want 
conversations to be efficient and to the point."
            </div>
        </div>
        
        <!-- Interactive Demo -->
        <div class="demo-section">
            <div class="flow-title">üöÄ Interactive Demo</div>
            <input type="text" class="demo-input" id="demoInput" placeholder="Try: 'I prefer working alone' or 'What do you know about my work style?'">
            <button class="demo-btn" onclick="processInput()">Process Input</button>
            <button class="demo-btn" onclick="clearDemo()" style="background: #666;">Clear</button>
            <div class="demo-output" id="demoOutput">Enter some text above to see how the memory system would process it...</div>
        </div>
    </div>

    <script>
        let currentExample = null;
        let storedMemories = [];
        
        function showExample(exampleId) {
            // Hide current example
            if (currentExample) {
                document.getElementById(currentExample).classList.remove('show');
            }
            
            // Show new example
            if (currentExample !== exampleId) {
                document.getElementById(exampleId).classList.add('show');
                currentExample = exampleId;
            } else {
                currentExample = null;
            }
        }
        
        function processInput() {
            const input = document.getElementById('demoInput').value;
            const output = document.getElementById('demoOutput');
            
            if (!input.trim()) {
                output.innerHTML = 'Please enter some text to process...';
                return;
            }
            
            // Memory write triggers
            const writeTriggers = ['I am', 'I have', 'I always', 'I never', 'I prefer', 'I hate', 'I usually', 'remember this'];
            const isWriteTriggered = writeTriggers.some(trigger => input.toLowerCase().includes(trigger.toLowerCase()));
            
            // Memory retrieval triggers  
            const retrieveTriggers = ['what do you know', 'what did i say', 'what are my', 'remind me', 'like i said'];
            const isRetrieveTriggered = retrieveTriggers.some(trigger => input.toLowerCase().includes(trigger.toLowerCase()));
            
            let result = `<div style="color: #00ff88;">Processing: "${input}"</div><br>`;
            
            if (isWriteTriggered) {
                result += `<span style="color: #ffaa00;">WRITE TRIGGER DETECTED</span><br>`;
                
                // Tag assignment
                let tag = 'identity';
                if (input.includes('prefer') || input.includes('hate')) tag = 'preference';
                else if (input.includes('always') || input.includes('usually')) tag = 'routine';
                else if (input.includes('want') || input.includes('goal')) tag = 'goal';
                
                result += `Tag assigned: <span style="color: #ff6666;">${tag}</span><br>`;
                result += `‚úÖ Stored in memory with embedding<br>`;
                
                // Simulate storage
                const memory = {
                    text: input,
                    tag: tag,
                    timestamp: new Date().toISOString()
                };
                storedMemories.push(memory);
                
            } else if (isRetrieveTriggered) {
                result += `<span style="color: #00aaff;">RETRIEVAL TRIGGER DETECTED</span><br>`;
                result += `Searching stored memories...<br>`;
                
                if (storedMemories.length > 0) {
                    result += `<span style="color: #00ff88;">Found ${storedMemories.length} relevant memories:</span><br>`;
                    storedMemories.forEach((mem, i) => {
                        result += `${i+1}. "${mem.text}" [${mem.tag}]<br>`;
                    });
                } else {
                    result += `<span style="color: #666;">No memories found. Try storing some first!</span><br>`;
                }
                
            } else {
                result += `<span style="color: #666;">No memory triggers detected</span><br>`;
                result += `This would be processed as normal conversation.`;
            }
            
            output.innerHTML = result;
        }
        
        function clearDemo() {
            document.getElementById('demoInput').value = '';
            document.getElementById('demoOutput').innerHTML = 'Enter some text above to see how the memory system would process it...';
            storedMemories = [];
        }
        
        // Add enter key support
        document.getElementById('demoInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                processInput();
            }
        });
    </script>
</body>
</html>
